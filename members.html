<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Birthdays</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f1e9;
            margin: 0;
            padding: 0;
            color: #333;
        }

        header {
            background-color: #002147;
            color: white;
            padding: 15px;
            text-align: center;
        }

        h1 {
            margin: 0;
        }

        .container {
            padding: 15px;
            max-width: 900px;
            margin: auto;
        }

        .form-section {
            background: #fff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
        }

        label {
            display: block;
            margin-top: 10px;
        }

        select, input, button {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background-color: #002147;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 15px;
        }

            button:hover {
                background-color: #004080;
            }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            padding: 8px;
            background: #fff;
            margin-bottom: 5px;
            border-radius: 4px;
            box-shadow: 0px 1px 3px rgba(0,0,0,0.1);
        }

        @media (max-width: 600px) {
            body {
                font-size: 16px;
            }

            button, select, input {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Member Birthdays</h1>
    </header>

    <div class="container" id="app" style="display:none;">

        <!-- Month Selector -->
        <div class="form-section">
            <label for="monthSelect">View Birthdays for:</label>
            <select id="monthSelect"></select>
            <button id="copyButton">Copy Current Members</button>
        </div>

        <!-- Member List -->
        <div class="form-section">
            <h2>Birthdays</h2>
            <ul id="memberList"></ul>
        </div>

        <!-- Add Member Form -->
        <div class="form-section">
            <h2>Add a Member</h2>
            <form id="addMemberForm">
                <label>
                    Name:
                    <input type="text" id="name" required>
                </label>

                <label>
                    Day:
                    <select id="day" required></select>
                </label>

                <label>
                    Month:
                    <select id="month" required></select>
                </label>

                <button type="submit">Add Member</button>
            </form>
        </div>
    </div>

    <script>const LEGACY_URL = "https://664a4c03a300e8795d419292.mockapi.io/members";
        const URL = "https://664a4c03a300e8795d419292.mockapi.io/members2";
        let members = [];

        async function fetchMembers() {
            members = [];
            const urls = [LEGACY_URL, URL];
            for (const u of urls) {
                const res = await fetch(u);
                const data = await res.json();
                members = members.concat(data.map(m => ({
                    name: m.name,
                    birthday: m.birthday,
                    birthmonth: m.birthmonth
                })));
            }
        }

        function displayMembers(month) {
            const list = document.getElementById("memberList");
            list.innerHTML = "";
            const filtered = members.filter(m => m.birthmonth == month);
            filtered.sort((a, b) => a.birthday - b.birthday);
            filtered.forEach(m => {
                const li = document.createElement("li");
                li.textContent = `${m.name} - ${m.birthmonth}/${m.birthday}`;
                list.appendChild(li);
            });
        }

        function populateDayDropdown(month) {
            const daySelect = document.getElementById("day");
            daySelect.innerHTML = "";
            const daysInMonth = new Date(2024, month, 0).getDate();
            for (let d = 1; d <= daysInMonth; d++) {
                const option = document.createElement("option");
                option.value = d;
                option.textContent = d;
                daySelect.appendChild(option);
            }
        }

        function populateMonthDropdowns() {
            const monthSelectForm = document.getElementById("month");
            const filterMonthSelect = document.getElementById("monthSelect");
            const monthNames = Array.from({ length: 12 }, (_, i) =>
                new Date(2000, i, 1).toLocaleString('default', { month: 'long' })
            );
            monthSelectForm.innerHTML = "";
            filterMonthSelect.innerHTML = "";
            monthNames.forEach((name, i) => {
                const option1 = document.createElement("option");
                option1.value = i + 1;
                option1.textContent = name;
                monthSelectForm.appendChild(option1);

                const option2 = document.createElement("option");
                option2.value = i + 1;
                option2.textContent = name;
                filterMonthSelect.appendChild(option2);
            });
            filterMonthSelect.value = new Date().getMonth() + 1;
            monthSelectForm.addEventListener("change", (e) => {
                populateDayDropdown(parseInt(e.target.value));
            });
            populateDayDropdown(new Date().getMonth() + 1);
        }

        async function addMember(name, day, month) {
            const newMember = { name, birthday: parseInt(day), birthmonth: parseInt(month) };
            await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newMember)
            });
            await init();
        }

        function copyCurrentMembers() {
            const currentMonth = parseInt(document.getElementById("monthSelect").value);
            const filtered = members.filter(m => m.birthmonth == currentMonth)
                .map(m => `${m.name} - ${m.birthmonth}/${m.birthday}`)
                .join("\n");
            navigator.clipboard.writeText(filtered).then(() => {
                alert("Copied to clipboard!");
            });
        }

        async function init() {
            await fetchMembers();
            const currentMonth = parseInt(document.getElementById("monthSelect").value);
            displayMembers(currentMonth);
        }

        document.getElementById("monthSelect").addEventListener("change", (e) => {
            displayMembers(parseInt(e.target.value));
        });
        document.getElementById("addMemberForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const name = document.getElementById("name").value.trim();
            const day = document.getElementById("day").value;
            const month = document.getElementById("month").value;
            if (name && day && month) {
                await addMember(name, day, month);
                e.target.reset();
                populateDayDropdown(new Date().getMonth() + 1);
            }
        });
        document.getElementById("copyButton").addEventListener("click", copyCurrentMembers);

        // Password Gate
        (function () {
            const code = prompt("Enter access code:");
            if (code && code.toLowerCase() === "tol") {
                document.getElementById("app").style.display = "block";
                populateMonthDropdowns();
                init();
            } else {
                document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;'>Access Denied</h2>";
            }
        })();</script>
</body>
</html>
